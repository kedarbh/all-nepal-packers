---
import Wrapper from "@components/ui/Wrapper.astro";
import { Icon } from "astro-icon/components";

const reasons = [
  { icon: "secure",          text: "Transparent pricing — no hidden charges" },
  { icon: "shooting-star",   text: "Trained, professional moving team" },
  { icon: "10-plus",         text: "10+ years experience across Nepal" },
  { icon: "location-filled", text: "Nationwide coverage — every district" },
  { icon: "flag",            text: "On-time pickup and delivery, guaranteed" },
  { icon: "hand-heart-fill", text: "Customer satisfaction, always first" },
];
---

<!-- Hero -->
<section class="py-24 bg-dark text-white relative overflow-hidden">
  <div class="absolute top-0 right-0 w-96 h-96 bg-primary/10 rounded-full blur-[120px] -z-0"></div>
  <div class="absolute bottom-0 left-0 w-72 h-72 bg-accent/5 rounded-full blur-[100px] -z-0"></div>
  <Wrapper class="relative z-10">
    <div class="inline-flex items-center gap-2 px-3 py-1 bg-primary-light/10 border border-primary-light/30 rounded-full mb-6">
      <span class="text-xs font-bold uppercase tracking-widest text-primary-light italic">100% Free · No Obligation</span>
    </div>
    <h1 class="text-5xl md:text-7xl font-black text-white leading-tight max-w-3xl">
      Get Your <span class="text-primary-light italic">Free</span> Moving Quote
    </h1>
    <p class="mt-5 text-lg text-gray-400 max-w-2xl leading-relaxed">
      Tell us about your move and we'll get back to you with a competitive quote within hours — no commitment required.
    </p>
  </Wrapper>
</section>

<!-- Form Section -->
<section class="py-20 bg-white">
  <Wrapper>
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-16 items-start">

      <!-- Form: 3 cols wide -->
      <div class="lg:col-span-3">
        <h2 class="text-2xl font-bold text-dark mb-1">Request a Quote</h2>
        <p class="text-gray-500 text-sm mb-8">Fill in the details below and we'll reach out with a tailored estimate.</p>

        <div id="quoteSuccess" class="hidden text-sm mb-6 border p-4 rounded-xl"></div>

        <form id="movingForm" class="space-y-5">
          <!-- Full Name -->
          <div>
            <label for="full-name" class="block text-sm font-semibold text-dark mb-2">
              Full Name <span class="text-accent">*</span>
            </label>
            <input
              type="text"
              name="name"
              required
              id="full-name"
              autocomplete="given-name"
              placeholder="Ram Sharma"
              class="w-full rounded-xl border border-borderGray bg-gray-50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition"
            />
          </div>

          <!-- Phone + Email -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
            <div>
              <label for="phone-number" class="block text-sm font-semibold text-dark mb-2">
                Phone Number <span class="text-accent">*</span>
              </label>
              <input
                type="tel"
                name="phone"
                id="phone-number"
                autocomplete="tel-national"
                pattern="[0-9]{10}"
                required
                placeholder="98xxxxxxxx"
                title="Mobile Number should be 10 digits"
                class="w-full rounded-xl border border-borderGray bg-gray-50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition"
              />
            </div>
            <div>
              <label for="email" class="block text-sm font-semibold text-dark mb-2">
                Email Address <span class="text-accent">*</span>
              </label>
              <input
                id="email"
                name="email"
                type="email"
                autocomplete="email"
                required
                placeholder="ram@example.com"
                class="w-full rounded-xl border border-borderGray bg-gray-50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition"
              />
            </div>
          </div>

          <!-- Move Type -->
          <div>
            <label for="move-type" class="block text-sm font-semibold text-dark mb-2">
              Move Type <span class="text-accent">*</span>
            </label>
            <select
              id="move-type"
              name="moveType"
              class="w-full rounded-xl border border-borderGray bg-gray-50 px-4 py-3 text-dark text-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition"
            >
              <option value="Apartment">Apartment / Flat</option>
              <option value="House">House</option>
              <option value="Office">Office</option>
              <option value="Motorbike">Motorbike</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <!-- Moving From + Moving To -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
            <div>
              <label for="move-from" class="block text-sm font-semibold text-dark mb-2">
                Moving From <span class="text-accent">*</span>
              </label>
              <input
                type="text"
                name="moveFrom"
                id="move-from"
                required
                autocomplete="address-level2"
                placeholder="e.g. Kathmandu"
                class="w-full rounded-xl border border-borderGray bg-gray-50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition"
              />
            </div>
            <div>
              <label for="move-to" class="block text-sm font-semibold text-dark mb-2">
                Moving To <span class="text-accent">*</span>
              </label>
              <input
                type="text"
                name="moveTo"
                id="move-to"
                required
                placeholder="e.g. Pokhara"
                class="w-full rounded-xl border border-borderGray bg-gray-50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition"
              />
            </div>
          </div>

          <button
            type="submit"
            class="w-full btn-primary py-4 text-base font-bold shadow-lg shadow-primary/20 flex items-center justify-center gap-2"
          >
            Get My Free Quote
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </button>

          <p class="text-center text-xs text-gray-400">
            We'll contact you within a few hours. No commitment required.
          </p>
        </form>

        <!-- Modal (keep existing functionality) -->
        <div id="myModal" style="display:none;position:fixed;z-index:50;inset:0;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;" class="flex">
          <div class="bg-white rounded-2xl p-8 shadow-2xl max-w-sm w-full mx-4 relative">
            <button id="closeModal" class="absolute top-4 right-4 text-gray-400 hover:text-dark text-2xl font-bold leading-none">&times;</button>
            <p id="modalMessage" class="text-dark font-semibold text-base text-center mt-2"></p>
          </div>
        </div>
      </div>

      <!-- Right col: Why Choose Us — 2 cols wide -->
      <div class="lg:col-span-2">
        <div class="sticky top-8">
          <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-6">Why Choose Us</h3>
          <ul class="space-y-4">
            {reasons.map(r => (
              <li class="flex items-start gap-4">
                <div class="w-9 h-9 rounded-xl bg-primary/10 flex items-center justify-center text-primary shrink-0 mt-0.5">
                  <Icon name={r.icon} class="w-5 h-5" />
                </div>
                <span class="text-sm text-dark font-medium leading-relaxed pt-1.5">{r.text}</span>
              </li>
            ))}
          </ul>

          <!-- Trust badge -->
          <div class="mt-10 p-5 bg-dark rounded-2xl">
            <p class="text-xs font-bold text-primary-light uppercase tracking-widest mb-3">Get in touch directly</p>
            <a
              href="tel:+9779843472589"
              class="flex items-center gap-3 text-white hover:text-primary-light transition-colors"
            >
              <div class="w-9 h-9 bg-primary-light/20 rounded-xl flex items-center justify-center">
                <Icon name="call" class="w-5 h-5 text-primary-light" />
              </div>
              <span class="text-lg font-bold">+977-9843472589</span>
            </a>
            <p class="text-xs text-gray-500 mt-2">Available Sun–Fri, 7 AM – 7 PM</p>
          </div>
        </div>
      </div>

    </div>
  </Wrapper>
</section>

<script>
  const modal = document.getElementById("myModal") as HTMLDivElement | null;
  const modalMessage = document.getElementById("modalMessage") as HTMLParagraphElement | null;

  function showModal(message: string) {
    if (modal && modalMessage) {
      modalMessage.textContent = message;
      modal.style.display = "flex";
    }
  }

  document.getElementById("closeModal")?.addEventListener("click", () => {
    if (modal) modal.style.display = "none";
  });

  document.getElementById("movingForm")?.addEventListener("submit", function (e) {
    e.preventDefault();
    showModal("Submitting your quote request...");

    const formData = new FormData(this as HTMLFormElement);

    fetch(
      "https://script.google.com/macros/s/AKfycbz9DL93sk9jUE0_T9EvW4z53PClrruxQ5pPJx7PNnvMmHKbm1w3sXszkwlPY2QLCT1l/exec",
      { method: "POST", body: formData }
    )
      .then((res) => {
        if (!res.ok) throw new Error("Network response was not ok");
        return res.text();
      })
      .then((data) => {
        if (data.startsWith("Error:")) throw new Error(data);
        showModal("✓ Quote request submitted! We'll contact you within a few hours.");
        (document.getElementById("movingForm") as HTMLFormElement)?.reset();
      })
      .catch((error) => {
        showModal("Submission failed: " + error.message);
      });
  });
</script>
