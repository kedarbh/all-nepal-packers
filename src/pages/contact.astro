---
import MainLayout from "@layouts/MainLayout.astro";
import Wrapper from "@components/ui/Wrapper.astro";
import { Icon } from "astro-icon/components";

const title = "Contact All Nepal Packers and Movers | Kathmandu Packers and Movers Support";
const description =
  "Contact the best moving company in Nepal for moving services like House Shifting, Office Shifting, and Flat Shifting. Call us at +977-9843472589 for a free moving quote.";
const tags = "contact packers and movers, Kathmandu movers contact, house shifting support Nepal, moving quote Nepal, All Nepal Packers phone number";

const contactDetails = [
  {
    icon: "call",
    label: "Phone Number",
    value: "+977-9843472589",
    href: "tel:+9779843472589",
  },
  {
    icon: "email-filled",
    label: "Email Address",
    value: "info@allnepalmovers.com.np",
    href: "mailto:info@allnepalmovers.com.np",
  },
  {
    icon: "location-filled",
    label: "Office Address",
    value: "Kathmandu, Nepal",
    href: "https://maps.google.com/?q=Kathmandu,Nepal",
  },
];
---

<MainLayout title={title} description={description} tags={tags}>
  <!-- Hero -->
  <section class="py-24 bg-dark text-white relative overflow-hidden">
    <div class="absolute top-0 right-0 w-96 h-96 bg-primary/10 rounded-full blur-[120px] -z-0"></div>
    <div class="absolute bottom-0 left-0 w-72 h-72 bg-accent/5 rounded-full blur-[100px] -z-0"></div>
    <Wrapper class="relative z-10">
      <div class="inline-flex items-center gap-2 px-3 py-1 bg-primary-light/10 border border-primary-light/30 rounded-full mb-6">
        <span class="text-xs font-bold uppercase tracking-widest text-primary-light italic">We're Here to Help</span>
      </div>
      <h1 class="text-5xl md:text-7xl font-black text-white leading-tight max-w-3xl">
        Get In <span class="text-primary-light italic">Touch</span>
      </h1>
      <p class="mt-6 text-lg text-gray-400 max-w-xl leading-relaxed">
        Have questions about our services or ready to plan your move? Reach out — our team is available every day to help you.
      </p>
    </Wrapper>
  </section>

  <!-- Main Content -->
  <section class="py-24 bg-white">
    <Wrapper>
      <div class="grid grid-cols-1 lg:grid-cols-5 gap-12 items-start">

        <!-- Left: Contact Info -->
        <div class="lg:col-span-2 space-y-8">
          <div>
            <h2 class="text-2xl font-bold text-dark mb-2">Contact Details</h2>
            <p class="text-gray-500 text-sm leading-relaxed">Reach out via phone, email, or visit our office. We respond within 1 business day.</p>
          </div>

          <div class="space-y-5">
            {contactDetails.map(detail => (
              <a
                href={detail.href}
                target={detail.href.startsWith("http") ? "_blank" : undefined}
                rel={detail.href.startsWith("http") ? "noopener noreferrer" : undefined}
                class="group flex items-center gap-5 p-5 rounded-2xl border border-borderGray hover:border-primary-light/40 hover:bg-primary/5 transition-all duration-300"
              >
                <div class="w-12 h-12 rounded-xl bg-primary flex items-center justify-center text-white shrink-0 group-hover:bg-primary-light transition-colors">
                  <Icon name={detail.icon} class="w-6 h-6" />
                </div>
                <div>
                  <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1">{detail.label}</p>
                  <p class="text-base font-semibold text-dark group-hover:text-primary transition-colors">{detail.value}</p>
                </div>
              </a>
            ))}
          </div>

          <!-- Business Hours -->
          <div class="p-6 bg-dark rounded-3xl text-white">
            <h3 class="text-sm font-bold text-primary-light uppercase tracking-widest mb-4">Business Hours</h3>
            <div class="space-y-2">
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Sunday – Friday</span>
                <span class="font-semibold text-white">7:00 AM – 10:00 PM</span>
              </div>
              <div class="flex justify-between text-sm">
                <span class="text-gray-400">Saturday</span>
                <span class="font-semibold text-white">9:00 AM – 5:00 PM</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Form -->
        <div class="lg:col-span-3 bg-white rounded-3xl border border-borderGray p-8 shadow-xl shadow-gray-100">
          <h2 class="text-2xl font-bold text-dark mb-2">Send Us a Message</h2>
          <p class="text-gray-500 text-sm mb-8">Fill in the details and we'll get back to you as soon as possible.</p>

          <div
            id="successMessage"
            class="hidden text-sm mb-6 border p-4 rounded-xl"
          ></div>

          <form id="contactForm" class="space-y-6">
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
              <div>
                <label for="first-name" class="block text-sm font-semibold text-dark mb-2">First Name <span class="text-accent">*</span></label>
                <input
                  type="text"
                  name="firstName"
                  required
                  id="first-name"
                  autocomplete="given-name"
                  placeholder="Ram"
                  class="w-full rounded-xl border border-borderGray bg-secondary/50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-transparent transition"
                />
              </div>
              <div>
                <label for="last-name" class="block text-sm font-semibold text-dark mb-2">Last Name <span class="text-accent">*</span></label>
                <input
                  type="text"
                  name="lastName"
                  required
                  id="last-name"
                  autocomplete="family-name"
                  placeholder="Sharma"
                  class="w-full rounded-xl border border-borderGray bg-secondary/50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-transparent transition"
                />
              </div>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
              <div>
                <label for="email" class="block text-sm font-semibold text-dark mb-2">Email Address <span class="text-accent">*</span></label>
                <input
                  id="email"
                  name="email"
                  type="email"
                  autocomplete="email"
                  required
                  placeholder="ram@example.com"
                  class="w-full rounded-xl border border-borderGray bg-secondary/50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-transparent transition"
                />
              </div>
              <div>
                <label for="phone-number" class="block text-sm font-semibold text-dark mb-2">Phone Number <span class="text-accent">*</span></label>
                <input
                  type="tel"
                  name="phone"
                  id="phone-number"
                  autocomplete="tel-national"
                  pattern="[0-9]{10}"
                  required
                  placeholder="9843472589"
                  title="Mobile Number should be 10 digit long"
                  class="w-full rounded-xl border border-borderGray bg-secondary/50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-transparent transition"
                />
              </div>
            </div>

            <div>
              <label for="message" class="block text-sm font-semibold text-dark mb-2">Message <span class="text-accent">*</span></label>
              <textarea
                name="message"
                id="message"
                required
                rows="5"
                placeholder="Tell us about your move — locations, date, items..."
                class="w-full rounded-xl border border-borderGray bg-secondary/50 px-4 py-3 text-dark text-sm placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-light focus:border-transparent transition resize-none"
              ></textarea>
            </div>

            <div class="flex items-start gap-3">
              <input
                type="checkbox"
                name="privacy"
                id="privacy"
                required
                class="mt-1 h-4 w-4 accent-primary rounded"
              />
              <label for="privacy" class="text-xs text-gray-500 leading-relaxed">
                I understand that any information submitted will be forwarded to our office by email and not via a secure messaging system.
              </label>
            </div>

            <button
              type="submit"
              class="w-full btn-primary py-4 text-base shadow-xl shadow-primary/20 flex items-center justify-center gap-2"
            >
              Send Message
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </button>
          </form>
        </div>
      </div>
    </Wrapper>
  </section>
</MainLayout>

<script>
  document
    .getElementById("contactForm")
    ?.addEventListener("submit", function (e) {
      e.preventDefault();

      const firstName = document.getElementById("first-name") as HTMLInputElement | null;
      const lastName = document.getElementById("last-name") as HTMLInputElement | null;
      const email = document.getElementById("email") as HTMLInputElement | null;
      const phone = document.getElementById("phone-number") as HTMLInputElement | null;
      const message = document.getElementById("message") as HTMLTextAreaElement | null;
      const privacy = document.getElementById("privacy") as HTMLInputElement | null;
      const successMessage = document.getElementById("successMessage") as HTMLDivElement | null;

      let valid = true;

      const clearErrors = () => {
        document.querySelectorAll(".error-message").forEach((msg) => msg.remove());
      };
      clearErrors();

      const showError = (input: HTMLInputElement | HTMLTextAreaElement | null, msg: string) => {
        if (input) {
          const error = document.createElement("div");
          error.className = "error-message text-red-500 text-xs mt-1";
          error.innerText = msg;
          input.parentElement?.appendChild(error);
          valid = false;
        }
      };

      if (!firstName?.value.trim()) showError(firstName, "First name is required");
      if (!lastName?.value.trim()) showError(lastName, "Last name is required");

      const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email?.value.trim()) showError(email, "Email is required");
      else if (!emailPattern.test(email.value.trim())) showError(email, "Please enter a valid email address");

      const phonePattern = /^[0-9]{10}$/;
      if (!phone?.value.trim()) showError(phone, "Phone number is required");
      else if (!phonePattern.test(phone.value.trim())) showError(phone, "Please enter a valid 10-digit phone number");

      if (!message?.value.trim()) showError(message, "Message is required");
      if (!privacy?.checked) showError(privacy, "You must agree to the privacy policy");

      if (valid) {
        const formData = new FormData(this as HTMLFormElement);
        const scriptURL = "https://script.google.com/macros/s/AKfycbzvXR-qd0kXunmU5FYVK9js2tDfcuRKjC3YCIUBPJwwaxv3OYohdDFpxUxUmi7qBOA/exec";

        fetch(scriptURL, { method: "POST", body: formData })
          .then((res) => { if (!res.ok) throw new Error("Network response was not ok"); return res.text(); })
          .then((data) => {
            if (data.startsWith("Error:")) throw new Error(data);
            successMessage!.className = "text-sm mb-6 border p-4 rounded-xl block bg-green-50 border-green-200 text-green-700";
            successMessage!.innerHTML = "✓ Message sent successfully! We'll get back to you shortly.";
            (document.getElementById("contactForm") as HTMLFormElement)?.reset();
          })
          .catch((error) => {
            successMessage!.className = "text-sm mb-6 border p-4 rounded-xl block bg-red-50 border-red-200 text-red-600";
            successMessage!.innerHTML = "Form submission failed: " + error.message;
          });
      }
    });
</script>
