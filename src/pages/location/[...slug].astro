---
import MainLayout from "@layouts/MainLayout.astro";
import { getImage } from "astro:assets";
import { getCollection, type CollectionEntry } from "astro:content";
import HeaderQuoteForm from "./_components/HeaderQuoteForm.astro";
import LocalServices from "./_components/LocalServices.astro";
import LocationProcess from "./_components/LocationProcess.astro";
import LocationCTA from "./_components/LocationCTA.astro";
import Wrapper from "@components/ui/Wrapper.astro";
import { Icon } from "astro-icon/components";

export async function getStaticPaths() {
  const locationPages = await getCollection("location");
  return locationPages.map((location) => ({
    params: { slug: location.slug },
    props: { location },
  }));
}

type Props = {
  location: CollectionEntry<"location">;
};

const { location } = Astro.props;
const { data, render } = location;
const { Content } = await render();
const bgImage: any = data.bgImage;
const optimizedImage = await getImage({ src: bgImage, width: 1920 });
const enhancedTags = [
  data.tags,
  `packers and movers in ${data.location}`,
  `house shifting ${data.location}`,
  `best movers ${data.location}`,
  `local moving services ${data.location}`
].filter(Boolean).join(", ");
---

<MainLayout
  title={data.title}
  description={data.description}
  coverImage={data.bgImage}
  tags={enhancedTags}
  pageType="website"
>
  <!-- Modern Hero Section -->
  <section class="relative min-h-[70vh] flex items-center overflow-hidden">
    <!-- Parallax-like Background -->
    <div 
      class="absolute inset-0 bg-cover bg-center bg-no-repeat z-0 transform scale-105"
      style={`background-image: url('${optimizedImage.src}'); filter: brightness(0.4);`}
    ></div>
    
    <!-- Gradient Overlay -->
    <div class="absolute inset-0 bg-gradient-to-r from-dark/90 via-dark/40 to-transparent z-10"></div>

    <Wrapper class="relative z-20 py-16 lg:py-24">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        <div class="text-white space-y-8 animate-in fade-in slide-in-from-left duration-1000">
          <div class="inline-flex items-center gap-2 px-3 py-1 bg-primary-light/10 border border-primary-light/30 rounded-full">
            <Icon name="location" class="w-4 h-4 text-primary-light" />
            <span class="text-xs font-bold uppercase tracking-widest text-primary-light">Expert Movers in {data.location}</span>
          </div>
          
          <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold leading-tight">
            Seamless Relocation in <span class="text-primary-light italic">{data.location}</span>
          </h1>
          
          <p class="text-xl text-gray-300 leading-relaxed max-w-xl">
            {data.introduction || `Relocating to or within ${data.location}? All Nepal Packers and Movers offers the most reliable, professional, and stress-free moving services customized for your needs.`}
          </p>

          <div class="flex flex-wrap gap-4 pt-4">
            <a href="#details" class="flex items-center gap-2 text-white font-semibold hover:text-primary transition-colors">
              Learn More
            </a>
          </div>
        </div>

        <div class="bg-white/95 backdrop-blur-md p-6 md:p-10 rounded-3xl shadow-2xl border border-white/20 animate-in fade-in slide-in-from-bottom duration-1000 delay-300">
           <HeaderQuoteForm />
        </div>
      </div>
    </Wrapper>
  </section>

  <!-- Location Specific Content -->
  <section id="details" class="py-20 lg:py-32 overflow-hidden">
    <Wrapper>
      <div class="grid lg:grid-cols-12 gap-16">
        <div class="lg:col-span-12">
          <div class="prose prose-lg max-w-none 
            prose-headings:text-dark prose-headings:font-bold prose-headings:font-display
            prose-p:text-gray-600 prose-p:leading-relaxed
            prose-strong:text-dark
            prose-a:text-primary prose-a:no-underline hover:prose-a:underline
            prose-img:rounded-2xl prose-img:shadow-xl
            prose-ul:text-gray-600">
            
            <div class="mb-16">
              <h2 class="text-4xl md:text-5xl font-bold mb-8">
                The Best Packers and Movers in <span class="text-primary">{data.location}</span>
              </h2>
              <div class="w-20 h-1.5 bg-primary rounded-full mb-8"></div>
            </div>

            <Content />
          </div>
        </div>
      </div>
    </Wrapper>
  </section>

  <!-- High-Quality Service Showcase -->
  <LocalServices location={data.location} />

  <!-- Local Highlights Content for SEO and Trust -->
  {data.localHighlights && data.localHighlights.length > 0 && (
    <section class="py-20 bg-white">
      <Wrapper>
        <div class="text-center mb-16">
          <h2 class="text-3xl md:text-5xl font-bold mb-4">
            Moving to <span class="text-primary italic">{data.location}</span>: Local Expertise
          </h2>
          <div class="w-20 h-1.5 bg-primary rounded-full mx-auto mb-8"></div>
          <p class="text-gray-600 max-w-2xl mx-auto">
            Our local {data.location} branch understands the unique logistics of moving in this area. Here is what makes our local service stand out:
          </p>
        </div>
        
        <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
          {data.localHighlights.map((highlight) => (
            <div class="bg-gray-50 p-8 rounded-2xl border border-borderGray hover:shadow-lg transition-shadow">
              <h3 class="text-xl font-bold text-dark mb-3 flex items-center gap-3">
                <Icon name="location" class="w-6 h-6 text-primary" />
                {highlight.title}
              </h3>
              <p class="text-gray-600 leading-relaxed">
                {highlight.description}
              </p>
            </div>
          ))}
        </div>
      </Wrapper>
    </section>
  )}

  <!-- Our Moving Process -->
  <LocationProcess />

  <!-- Trust Badges & Local Expertise -->
  <section class="py-20 bg-gray-50/50">
    <Wrapper>
      <div class="bg-white p-8 md:p-12 rounded-[2rem] border border-borderGray shadow-sm">
        <div class="grid md:grid-cols-3 gap-8 text-center divide-y md:divide-y-0 md:divide-x divide-gray-100">
          <div class="px-4">
            <div class="text-4xl font-bold text-primary mb-2">10+</div>
            <div class="text-gray-600 font-medium">Years Experience in {data.location}</div>
          </div>
          <div class="px-4 py-6 md:py-0">
            <div class="text-4xl font-bold text-primary mb-2">5000+</div>
            <div class="text-gray-600 font-medium">Successful Moves Locally</div>
          </div>
          <div class="px-4 pt-6 md:pt-0">
            <div class="text-4xl font-bold text-primary mb-2">#1</div>
            <div class="text-gray-600 font-medium">Rated by {data.location} Residents</div>
          </div>
        </div>
      </div>
    </Wrapper>
  </section>

  <!-- Final CTA -->
  <LocationCTA location={data.location} />

</MainLayout>

<style>
  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  @keyframes slide-in-from-left {
    from { transform: translateX(-50px); }
    to { transform: translateX(0); }
  }
  @keyframes slide-in-from-bottom {
    from { transform: translateY(50px); }
    to { transform: translateY(0); }
  }
  
  .animate-in {
    animation-fill-mode: both;
  }
  .fade-in {
    animation-name: fade-in;
  }
  .slide-in-from-left {
    animation-name: slide-in-from-left;
  }
  .slide-in-from-bottom {
    animation-name: slide-in-from-bottom;
  }
</style>
